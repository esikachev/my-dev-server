language: python

before_install:
  - pip install tox
  - git clone -b es-macosx-server https://github.com/esikachev/my-dev-ci-config.git
  - mysql -e 'CREATE DATABASE IF NOT EXISTS my_dev;'

os:
  - linux
  - osx

addons:
  apt:
    packages:
      - mysql-server
  brew_packages: mysql

matrix:
  include:
    - python: 2.7
      env: TOX_ENV=pep8
      sudo: required
    - python: 2.7
      env: TOX_ENV=py27
      sudo: required
    - python: 2.7
      env: TOX_ENV=migration
      sudo: required
    - python: 2.7
      env: TOX_ENV=api
      sudo: required
    - python: 2.7
      env: TOX_ENV=functional-client
      sudo: required
    - python: 2.7
      env: TOX_ENV=cli-client
      sudo: required

script:
  - my-dev-ci-config/runner.sh

after_script:
  - if [ -f my-dev-server-logs ]; then
      cat my-dev-server-logs;
    fi  
